[SERVICE]
    Flush         5
    Daemon        Off
    Log_Level     info
    Parsers_File  parsers.conf
    HTTP_Server   On
    HTTP_Listen   0.0.0.0
    HTTP_Port     2020

# Collect Docker container logs
[INPUT]
    Name              tail
    Path              /var/lib/docker/containers/*/*.log
    Parser            docker
    Tag               docker.<container_id>
    Tag_Regex         (?<container_id>[a-z0-9]{64})-json\.log$
    Refresh_Interval  10
    Mem_Buf_Limit     5MB
    Skip_Long_Lines   On
    DB                /var/log/flb_docker.db
    Read_from_Head    On

# Extract container name from Docker config
[FILTER]
    Name          lua
    Match         docker.*
    script        /fluent-bit/etc/docker_metadata.lua
    call          add_container_name

# Add labels for homelab environment
[FILTER]
    Name          modify
    Match         *
    Add           environment homelab
    Add           infrastructure 83rr-poweredge

# Output to OpenSearch
[OUTPUT]
    Name            opensearch
    Match           *
    Host            opensearch
    Port            9200
    Logstash_Format On
    Logstash_Prefix logs-homelab
    Suppress_Type_Name On
    Retry_Limit     5
    Buffer_Size     5MB
