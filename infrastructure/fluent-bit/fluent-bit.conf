[SERVICE]
    Flush         5
    Daemon        Off
    Log_Level     info
    Parsers_File  parsers.conf
    HTTP_Server   On
    HTTP_Listen   0.0.0.0
    HTTP_Port     2020

# Collect Docker container logs
[INPUT]
    Name              tail
    Path              /var/lib/docker/containers/*/*.log
    Parser            docker
    Tag               docker.<container_id>
    Tag_Regex         (?<container_id>[a-z0-9]{64})-json\.log$
    Refresh_Interval  10
    Mem_Buf_Limit     5MB
    Skip_Long_Lines   On
    DB                /var/log/flb_docker.db
    Read_from_Head    On

# Collect Plex Media Server logs (written to file, not stdout)
[INPUT]
    Name              tail
    Path              /plex-logs/Library/Application Support/Plex Media Server/Logs/Plex Media Server.log
    Tag               plex.server
    Refresh_Interval  10
    Mem_Buf_Limit     5MB
    Skip_Long_Lines   On
    DB                /var/log/flb_plex.db
    Read_from_Head    False

# Collect Seafile logs (written to file, not stdout)
[INPUT]
    Name              tail
    Path              /seafile-logs/seahub.log
    Tag               seafile.seahub
    Refresh_Interval  10
    Mem_Buf_Limit     5MB
    Skip_Long_Lines   On
    DB                /var/log/flb_seafile_seahub.db
    Read_from_Head    False

[INPUT]
    Name              tail
    Path              /seafile-logs/seafile.log
    Tag               seafile.server
    Refresh_Interval  10
    Mem_Buf_Limit     5MB
    Skip_Long_Lines   On
    DB                /var/log/flb_seafile_server.db
    Read_from_Head    False

# Extract container name from Docker config
[FILTER]
    Name          lua
    Match         docker.*
    script        /fluent-bit/etc/docker_metadata.lua
    call          add_container_name

# Add container name for Plex file logs
[FILTER]
    Name          modify
    Match         plex.*
    Add           container_name plex
    Add           source file

# Add container name for Seafile file logs
[FILTER]
    Name          modify
    Match         seafile.*
    Add           container_name seafile
    Add           source file

# Add labels for homelab environment
[FILTER]
    Name          modify
    Match         *
    Add           environment homelab
    Add           infrastructure 83rr-poweredge

# Output to OpenSearch
[OUTPUT]
    Name            opensearch
    Match           *
    Host            opensearch
    Port            9200
    Logstash_Format On
    Logstash_Prefix logs-homelab
    Suppress_Type_Name On
    Retry_Limit     5
    Buffer_Size     5MB
